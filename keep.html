<!-- ... ä¸Šé¢æ˜¯åŸæœ‰çš„ script å¼•ç”¨ ... -->
    <script src="js/download_img.js"></script>
    <script src="js/drawMine.js"></script>
    <script src="js/onload.js"></script>

    <!-- ğŸ”´ æ–°å¢çš„å¤©æ°”ä»£ç æ”¾åœ¨è¿™é‡Œï¼Œä¸€å®šè¦æœ‰ script æ ‡ç­¾ ğŸ”´ -->
    <script>
        /**
         * è·å–å“ˆå°”æ»¨å·¥ç¨‹å¤§å­¦å®æ—¶å¤©æ°”
         * ä½¿ç”¨ Open-Meteo API (å…è´¹ï¼Œæ— éœ€Key)
         */
        async function getHeuWeather() {
            // å“ˆå°”æ»¨å·¥ç¨‹å¤§å­¦å—ä½“è‚²åœºé™„è¿‘åæ ‡
            const lat = 45.773;
            const lon = 126.679;
            
            // API åœ°å€ï¼šè·å–æ¸©åº¦ã€æ¹¿åº¦ã€å¤©æ°”ä»£ç 
            const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code&timezone=Asia%2FShanghai`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Weather API failed');
                
                const data = await response.json();
                const current = data.current;

                // 1. è·å– DOM å…ƒç´ 
                const tempInp = document.getElementById('inpt_temperature');
                const humInp = document.getElementById('inpt_humidity');
                const weatherSelect = document.getElementById('weather_Select');
                
                // 2. æ›´æ–°æ•°å€¼
                // å†™å…¥æ¸©åº¦ (å››èˆäº”å…¥)
                if (tempInp) {
                    tempInp.value = Math.round(current.temperature_2m);
                    // è§¦å‘ onchange äº‹ä»¶ï¼Œç¡®ä¿é¢„è§ˆå›¾åŒæ­¥æ›´æ–°
                    tempInp.dispatchEvent(new Event('change'));
                }

                // å†™å…¥æ¹¿åº¦ (åŠ ä¸Šç™¾åˆ†å·)
                if (humInp) {
                    humInp.value = Math.round(current.relative_humidity_2m) + '%';
                    humInp.dispatchEvent(new Event('change'));
                }

                // 3. è‡ªåŠ¨åˆ‡æ¢å¤©æ°”å›¾æ ‡
                // Open-Meteo WMO Weather Code æ˜ å°„åˆ° Keep çš„å›¾æ ‡
                const wCode = current.weather_code;
                let weatherVal = "images/weather1.png"; // é»˜è®¤æ™´

                if (wCode <= 1) {
                    weatherVal = "images/weather1.png"; // æ™´
                } else if (wCode === 2) {
                    weatherVal = "images/weather2.png"; // å¤šäº‘
                } else {
                    weatherVal = "images/weather3.png"; // é˜´/é›¨/é›ª
                }

                if (weatherSelect) {
                    weatherSelect.value = weatherVal;
                    // è§¦å‘ onchange ä»¥æ›´æ–°å›¾ç‰‡
                    weatherSelect.dispatchEvent(new Event('change')); 
                }

                console.log(`å·²æ›´æ–°å“ˆå·¥ç¨‹å¤©æ°”: ${current.temperature_2m}Â°C, ${weatherVal}`);

            } catch (error) {
                console.error("å¤©æ°”è·å–å¤±è´¥:", error);
                // å¤±è´¥æ—¶çš„å…œåº•æ•°æ®
                const tempEl = document.getElementById('inpt_temperature');
                const humEl = document.getElementById('inpt_humidity');
                if(tempEl) tempEl.value = "20";
                if(humEl) humEl.value = "45%";
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            getHeuWeather();
        });
    </script>
</body>
</html>