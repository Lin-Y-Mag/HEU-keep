<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <!-- è°·æ­Œç»Ÿè®¡ -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4C56GQP4ZL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-4C56GQP4ZL');
    </script>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>KEEPro - è¿åŠ¨æˆªå›¾ç”Ÿæˆ</title>
    <link rel="icon" href="./favicon.ico">
    <link rel="stylesheet" href="./css/styles.css">

    <!-- ğŸ¨ æ ¸å¿ƒä¿®å¤æ ·å¼ï¼šéšè—ç¬¦å· + ç´§å‡‘å¸ƒå±€ -->
    <style>
        /* ã€æ ¸å¿ƒã€‘éšè— data-text äº§ç”Ÿçš„ç¬¦å·ï¼Œä½†ä¿ç•™å±æ€§ä¾› JS è¯»å– */
        label[data-text]::before,
        div[data-text]::before,
        li[data-text]::before {
            content: none !important;
            display: none !important;
        }

        /* é¢æ¿ç´§å‡‘åŒ–ä¸ç¾åŒ– */
        .set-data .background-green, 
        .set-data .background-blue, 
        .set-data .background-color-block2 {
            padding: 10px 12px !important; 
            margin-bottom: 10px !important;
            border-radius: 10px;
            /* åŠ ä¸Šä¹‹å‰çš„å·¦ä¾§å½©æ¡ */
            border-left-width: 5px; 
            border-left-style: solid;
        }
        .background-green { border-left-color: #24c68a; }
        .background-blue { border-left-color: #5d52ff; }
        .background-color-block2 { border-left-color: #ff9f43; }
        
        /* åˆ—è¡¨é¡¹å¸ƒå±€ */
        .setDataList li {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 8px !important;
            gap: 5px;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .set-data label {
            font-size: 13px;
            min-width: auto !important; /* å–æ¶ˆå›ºå®šå®½åº¦ */
            margin-right: 5px;
            color: #333;
            font-weight: bold;
        }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        .set-data input[type="text"], 
        .set-data select {
            height: 30px !important;
            padding: 0 8px !important;
            font-size: 13px !important;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fff;
        }

        /* æŒ‰é’®ç»„ */
        .header-container {
            padding: 10px !important;
            gap: 8px !important;
            justify-content: flex-start;
            flex-wrap: wrap;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .header-container button {
            font-size: 12px;
            padding: 0 12px;
            height: 32px;
            line-height: 30px;
            border-radius: 5px;
            margin: 0 !important;
        }

        /* èŒƒå›´è¾“å…¥æ¡†åŒºåŸŸ */
        .background-color-block1 {
            display: inline-flex;
            align-items: center;
            background: #f0f2f5;
            padding: 3px 8px;
            border-radius: 5px;
            margin-top: 0 !important;
            width: auto !important;
            font-size: 12px;
            color: #666;
        }
        .mile2-inp.range-input {
            width: 40px !important;
            text-align: center;
            background: transparent !important;
            border: none !important;
            border-bottom: 1px solid #999 !important;
            border-radius: 0 !important;
            height: 20px !important;
        }
        
        /* æŒ‰é’®é¢œè‰²ä¿®å¤ */
        .large-btn { background: #24c68a; color: white; border: none; }
        .flush-btn { background: #24c68a; color: white; border: none; }
        .storeToIndexedDB-btn { background: #24c68a; color: white; border: none; }
        .clear-btn { background: #ff6b6b; color: white; border: none; }
        .one_click { background: #5d52ff; color: white; border: none; }
        .init-btn { background: #fff; border: 1px solid #ccc; color: #666; }

        /* ç§»é™¤æ°´å¹³çº¿å¸¦æ¥çš„é¢å¤–é—´è· */
        hr { margin: 10px 0; border-color: #eee; }
    </style>
</head>

<body id="body">

    <div id="main-div">
        <!-- =========================================
             å·¦ä¾§ï¼šé¢„è§ˆå›¾åŒºåŸŸ (å®Œå…¨ä¸åŠ¨ï¼Œç¡®ä¿æ•°æ®æ˜ å°„æ­£ç¡®)
             ========================================= -->
        <div id="new-Img" class="new-img">
            <div class="bgimgwrap" id="bgimgwrap">
                <img src="" class="innerbgimg" id="bg-img" />
            </div>
            <img src="" id="gui-img" />
            <div class="portrait-wrap" id="portrait-wrap">
                <img class="portrait" id="portrait" src="" />
            </div>
            <div class="weather-imgwrap">
                <img src="" class="weather" id="weather" />
            </div>
            <span class="username" id="username">UserName</span>
            <span class="keep-title" id="keep-title">æˆ·å¤–è·‘æ­¥</span>
            <span class="mile"><span id="mile" class="mile-data">0.00</span><span class="gongli">å…¬é‡Œ</span></span>
            <span class="datetime date" id="date">0000/00/00</span>
            <span class="datetime time" id="time">00:00</span>
            <span class="env temperature" id="temperature">00</span>
            <span class="env humidity" id="humidity">00</span>
            <span class="speed-time speed" id="speed">00'00"</span>
            <span class="speed-time cost-time" id="cost-time">00:00:00</span>
            <span class="speed-time calorie" id="calorie">0</span>
        </div>

        <!-- =========================================
             å³ä¾§ï¼šæ§åˆ¶é¢æ¿ (ç»“æ„ä¿®å¤ç‰ˆ)
             ========================================= -->
        <div class="set-data">
            <div id="messageBox"></div>
            
            <!-- é¡¶éƒ¨æŒ‰é’® -->
            <div class="header-container">
                <button onclick="Download(Download1)" class="one_click">â¬‡ï¸ ä¿å­˜å›¾ç‰‡</button>
                <button onclick="Download(Download2)" class="one_click">ğŸ‘ï¸ é¢„è§ˆ</button>
                <button onclick="drawMine('https://tool.joytion.cn/generate-track')" class="flush-btn">ğŸ² éšæœºè·¯å¾„</button>
                <button onclick="storeToIndexedDB(tmp_portrait_src,tmp_bgimg_osrc)" class="storeToIndexedDB-btn">ğŸ’¾ ä¿å­˜ä¿¡æ¯</button>
                <button onclick="clearIndexedDB()" class="clear-btn">ğŸ—‘ï¸ é‡ç½®</button>
            </div>

            <ul class="setDataList">
                <!-- 1. ä¸ªäººä¿¡æ¯ -->
                <div class="background-green">
                    <li>
                        <!-- data-text="âˆš" æ˜¯ JS è¯†åˆ«å…³é”®ï¼ŒCSSå·²éšè— -->
                        <label data-text="âˆš">æ˜µç§°ï¼š</label>
                        <input id="inpt_username" onchange="setData()" type="text" class="username-inp" style="width: 120px;" value="KeepRun">
                    </li>
                    <li>
                        <label data-text="âˆš">å¤´åƒï¼š</label>
                        <button onclick="inpt_portrait_onClick()" class="inpt-btn">ä¸Šä¼ </button>
                        <button onclick="init_portrait()" class="init-btn" style="margin-left:5px;">é»˜è®¤</button>
                        <input style="display:none;" type="file" accept="image/*" id="inpt_portrait" onchange="portrait_inpt()" />
                    </li>
                    <li>
                        <label data-text="âˆš">æ ‡é¢˜ï¼š</label>
                        <span>keep â€¢ </span>
                        <input id="inpt_keep_title" onchange="setData()" type="text" class="keep-title-inp" style="width: 120px;" value="æˆ·å¤–è·‘æ­¥">
                    </li>
                </div>
                
                <!-- 2. è¿åŠ¨æ•°æ® -->
                <div class="background-blue">
                    <li>
                        <label data-text="#rand">é‡Œç¨‹(km)ï¼š</label>
                        <input id="inpt_miles" onchange="setData()" class="mile2-inp" style="width: 70px; font-weight: bold; color:#24c68a;" value="5.00">
                        <div class="background-color-block1">
                            <span>éšæœºèŒƒå›´:</span>
                            <input type="text" id="min_miles" onchange="set_km_and_speed()" class="mile2-inp range-input" value="3.0">
                            ~ <input type="text" id="max_miles" onchange="set_km_and_speed()" class="mile2-inp range-input" value="10.0">
                        </div>
                    </li>
                    <li>
                        <label data-text="#rand">é…é€Ÿï¼š</label>
                        <input id="inpt_speeds" onchange="setData()" type="text" class="mile2-inp" style="width: 70px;" value="5'30&quot;">
                        <div class="background-color-block1">
                            <span>éšæœºèŒƒå›´:</span>
                            <input type="text" id="min_speeds" onchange="set_km_and_speed()" class="mile2-inp range-input" value="4.5">
                            ~ <input type="text" id="max_speeds" onchange="set_km_and_speed()" class="mile2-inp range-input" value="6.0">
                        </div>
                    </li>
                </div>

                <!-- 3. æ—¶é—´ä¸å¤©æ°” -->
                <!-- data-text="#live" ç”¨äºè‡ªåŠ¨è·å–å¤©æ°”å’Œæ—¶é—´ -->
                <div class="background-color-block2" data-text="#live">
                    <li>
                        <label data-text="#live">æ—¶é—´:</label>
                        <input id="inpt_year" onchange="setData()" type="text" class="time-inp year-inp" style="width: 40px;"> å¹´
                        <input id="inpt_month" onchange="setData()" type="text" class="time-inp" style="width: 25px;"> æœˆ
                        <input id="inpt_day" onchange="setData()" type="text" class="time-inp" style="width: 25px;"> æ—¥
                        &nbsp;
                        <input id="inpt_hour" onchange="setData()" type="text" class="time-inp" style="width: 25px;"> :
                        <input id="inpt_min" onchange="setData()" type="text" class="time-inp" style="width: 25px;">
                    </li>
                </div>
                <div class="weather-container">
                    <div class="background-color-block2" data-text="#live">
                        <li>
                            <label data-text="#live">å¤©æ°”:</label>
                            <select onchange="weather_Select_onChange()" id="weather_Select" style="width: 70px;">
                                <option value="images/weather1.png">â˜€ æ™´</option>
                                <option value="images/weather2.png">â›… å¤šäº‘</option>
                                <option value="images/weather3.png">â˜ é˜´å¤©</option>
                            </select>
                            &nbsp;
                            <label>æ¸©/æ¹¿:</label>
                            <input id="inpt_temperature" onchange="setData()" type="text" style="width: 30px;"> Â°C
                            <input id="inpt_humidity" onchange="setData()" type="text" style="width: 30px;"> %
                        </li>
                    </div>
                </div>

                <!-- 4. åœ°å›¾ä¸è½¨è¿¹ -->
                <div class="background-green">
                    <li>
                        <label data-text="âˆš">èƒŒæ™¯å›¾ï¼š</label>
                        <select onchange="default_bgImgSelect_onChange()" id="default_bgImgSelect" style="flex: 1;">
                            <option value="guiji_Select_1">å“ˆå·¥ç¨‹-å—ä½“è‚²åœº</option>
                            <option value="guiji_Select_2">å†›å·¥æ“åœº</option>
                            <option value="guiji_Select_3">åŒ—ä½“è‚²åœº</option>
                        </select>
                    </li>
                    <li>
                        <label data-text="âˆš">è‡ªå®šä¹‰ï¼š</label>
                        <button onclick="inpt_bgimg_onClick()" class="init-btn">ä¸Šä¼ </button>
                        <button onclick="init_bgimg()" class="init-btn" style="margin-left:5px;">é»˜è®¤</button>
                        <input style="display:none;" type="file" accept="image/*" id="inpt_bgimg" onchange="bgimg_inpt()" />
                    </li>

                    <li>
                        <label>è½¨è¿¹ï¼š</label>
                        <select onchange="guijiSelect_onChange()" id="guiji_Select_1" class="guijiSelect" style="flex: 1;">
                            <option value="['images/bg1_1.png', 'images/bg1_empty2.png']">é¢„è®¾ 1</option>
                            <option value="['images/bg1_2.png', 'images/bg1_empty2.png']">é¢„è®¾ 2</option>
                            <option value="['images/bg1_3.png', 'images/bg1_empty2.png']">é¢„è®¾ 3</option>
                            <option value="['images/bg1_4.png', 'images/bg1_empty2.png']">é¢„è®¾ 4</option>
                            <option value="['images/bg1_5.png', 'images/bg1_empty2.png']">é¢„è®¾ 5</option>
                            <option value="['images/bg1_empty2.png', 'images/bg1_empty2.png']">æ— é¢„è®¾</option>
                        </select>
                        <!-- éšè—çš„selectï¼Œä¿è¯JSé€»è¾‘ä¸æŠ¥é”™ -->
                        <select onchange="guijiSelect_onChange()" id="guiji_Select_2" class="guijiSelect" style="display: none;">
                            <option value="['images/bg2_empty.png', 'images/bg2_empty.png']">ç©º</option>
                        </select>
                        <select onchange="guijiSelect_onChange()" id="guiji_Select_3" class="guijiSelect" style="display: none;">
                            <option value="['images/bg3_empty.png', 'images/bg3_empty.png']">ç©º</option>
                        </select>
                        <button onclick="inpt_drawbtn_onClick()" style="margin-left: 5px; color: #5d52ff; border:none; background:none; cursor:pointer;">âœï¸ æ‰‹ç»˜</button>
                    </li>
                    
                    <li style="background: #f9f9f9; padding: 5px; border-radius: 5px;">
                        <label data-text="âˆš">é€‰é¡¹ï¼š</label>
                        <input type="checkbox" id="auto_draw_checkbox" onchange="auto_draw_checkbox_onchange()" checked /><span>è‡ªåŠ¨ç”Ÿæˆ</span>
                        &nbsp;|&nbsp;
                        <input type="checkbox" id="inpt_colorchange_checkbox" onchange="inpt_colorchange_checkbox_onchange()" checked /><span>é…é€Ÿå˜è‰²</span>
                    </li>
                    
                    <li id="bs_prop_inpt_wrap">
                        <label data-text="âˆš">å˜è‰²è®¾ç½®ï¼š</label>
                        <input id="inpt_bs_prob" onchange="setData()" type="text" style="width: 40px;" value="0.5">
                        <span style="font-size:12px; color:#666; margin:0 5px;">æ¦‚ç‡ | æ­¥é•¿</span>
                        <input id="inpt_bs_range_min" onchange="setData()" type="text" style="width: 30px;" value="3">
                        ~
                        <input id="inpt_bs_range_max" onchange="setData()" type="text" style="width: 30px;" value="10">
                    </li>
                </div>
                
                <div class="background-green" style="display: flex; justify-content: space-between;">
                    <label data-text="âˆš">ç”Ÿæˆå®½åº¦ (px)ï¼š</label>
                    <input id="inpt_savePic_width" onchange="setData()" type="text" style="width: 100px;">
                </div>
                
                <!-- åº•éƒ¨æ“ä½œ -->
                <li style="margin-top: 15px;">
                    <button onclick="Download(Download1)" class="large-btn" style="width: 100%;">ğŸš€ ç«‹å³ç”Ÿæˆå›¾ç‰‡</button>
                </li>
                <li style="display: flex; gap: 10px;">
                    <button onclick="Download(Download3)" class="init-btn" style="flex: 1;">å¤‡ç”¨æ–¹æ¡ˆ A</button>
                    <button onclick="Download(Download4)" class="init-btn" style="flex: 1;">å¤‡ç”¨æ–¹æ¡ˆ B</button>
                </li>
            </ul>

            <!-- æ‰‹åŠ¨ç»˜åˆ¶å¼¹çª— -->
            <div id="drawpic_overlay">
                <div class="drawpic_popup">
                    <div><h5>ç»˜åˆ¶è½¨è¿¹</h5></div>
                    <div id="drawpic_canvas_wrap2">
                        <div id="drawpic_canvas_wrap">
                            <canvas id="drawpic_canvas" width="1" height="1"></canvas>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="drawpic_hidebtn_onClick()">å–æ¶ˆ</button>
                        <button onclick="drawpic_initbtn_onClick()" class="init-btn">æ¸…ç©º</button>
                        <button onclick="Json2Draw('https://tool.joytion.cn/generate-track')" class="flush-btn">ğŸ² éšæœº</button>
                        <button onclick="drawpic_yesbtn_onClick()" class="large-btn">ç¡®å®š</button>
                    </div>
                    <canvas id="buffer_canvas" style="display: none;"></canvas>
                </div>
            </div>
        </div>
        
        <div class="warning-wrap" style="padding: 10px;">
            <ul class="setDataList">
                <li>
                    <div class="warning">
                        <span style="font-size: 12px; color:#999;">
                            <b>âš ï¸ æç¤º:</b> ä¿®æ”¹ä¸Šæ–¹æ•°æ®ï¼Œé¢„è§ˆå›¾ä¼šè‡ªåŠ¨æ›´æ–°ã€‚
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- è„šæœ¬åŠ è½½ï¼šç¡®ä¿æ—  deferï¼ŒæŒ‰é¡ºåºæ‰§è¡Œ -->
    <script src="js/invoke/html2canvas.min.js"></script>
    <script src="js/invoke/amapHelper.js"></script>
    <script src="js/indexedDB.js"></script>
    <script src="js/init.js"></script>
    <script src="js/render.js"></script>
    <script src="js/select_manner.js"></script>
    <script src="js/dataURLtoBlob.js"></script>
    <script src="js/img_both_inpt_set.js"></script>
    <script src="js/draw_personalization.js"></script>
    <script src="js/download_img.js"></script>
    <script src="js/drawMine.js"></script>
    <script src="js/onload.js"></script>
    
    <!-- å¼ºåˆ¶åˆ·æ–°è„šæœ¬ï¼šé˜²æ­¢æ•°æ®ä¸åŒæ­¥ -->
    <script>
        window.onload = function() {
            // å»¶è¿Ÿ 500ms æ‰§è¡Œä¸€æ¬¡ setDataï¼Œç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæ¯•ååˆ·æ–°é¢„è§ˆå›¾
            setTimeout(function(){
                if(typeof setData === 'function') {
                    setData();
                    console.log("Forced update trigger executed.");
                }
            }, 500);
        }
    </script>
</body>

</html>